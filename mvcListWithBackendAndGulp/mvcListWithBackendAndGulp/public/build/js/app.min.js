!function(){"use strict";class t{constructor(){this.sortingConfig={A:t=>(t.sort((t,e)=>t.email>e.email?1:-1),t),Z:t=>(t.sort((t,e)=>t.email<e.email?1:-1),t),Admin:t=>t.filter(t=>"Admin"==t.role),User:t=>t.filter(t=>"User"==t.role),Find:t=>{let e=new RegExp(event.target.value,"i");return t.filter(t=>e.test(t.name))}}}static initTemplate(t,e){var s=document.querySelector(`#${e}`).content.cloneNode(!0);t.innerHTML="",t.appendChild(s)}static navigateTo(t){window.location.hash=`#${t}`}static isLoggedIn(){return!!JSON.parse(localStorage.getItem("credentials"))}}const e=document.querySelector("#wrapper");let s={"":()=>{t.initTemplate(e,"login-view"),new class{constructor(t,e,s){this.model=t,this.view=e,this.utils=s,this.initListeners()}initListeners(){this.view.DOMElements.logInBtn.addEventListener("click",this.loginHandler.bind(this)),this.view.DOMElements.logOutBtn.addEventListener("click",this.logoutHandler.bind(this))}loginHandler(t){t.preventDefault();let e=this.view.getCredentials();this.model.validate(e)?this.model.login(e).then(t=>{t.loginStatus?(this.view.hideMsg(),this.view.showLogout(),this.utils.navigateTo("gallery")):this.view.showMsg(this.model.getErrorMsg())}):this.view.showMsg(this.model.getErrorMsg())}logoutHandler(){this.view.hideLogout(),this.model.logout(),this.utils.navigateTo("")}}(new class{constructor(){this.loginUrl="http://localhost:3000/login",this.emailPattern=/^\w+@\w+\.\w{2,4}$/i,this.passwordPattern=/^[a-zA-Z0-9]{8,30}$/,this.errorMsg=null,this.errorMsgMap={empty:"Пожалуйста заполните поля логин и пароль",loginError:"Логин введен неверно. Только латинские буквы.",passError:"Пароль введен неверно. Тольк латинские буквы, цифры. Длина не менее 8 символов",missmatch:"Неправильные логин или пароль."}}validate(t){return this.isEmpty(t)&&this.isEmailAssertPattern(t)&&this.isPasswordAssertPattern(t)}login(t){let e={headers:{"Content-type":"application/json; charset=utf-8"},method:"post",body:JSON.stringify(t)};return fetch(this.loginUrl,e).then(t=>t.json()).then(e=>(e.loginStatus?localStorage.setItem("credentials",JSON.stringify(t)):this.setErrorMsg("missmatch"),e))}getErrorMsg(){return this.errorMsg}setErrorMsg(t){return this.errorMsg=this.errorMsgMap[t],!1}isEmpty(t){return t.login&&t.password||this.setErrorMsg("empty")}isEmailAssertPattern(t){return this.emailPattern.test(t.login)||this.setErrorMsg("loginError")}isPasswordAssertPattern(t){return this.passwordPattern.test(t.password)||this.setErrorMsg("passError")}logout(){localStorage.removeItem("credentials")}},new class{constructor(){this.DOMElements={login:document.querySelector("#inputEmail"),password:document.querySelector("#inputPassword"),alert:document.querySelector(".alert"),logInBtn:document.querySelector("#log-in-btn"),logOutBtn:document.querySelector("#log-out-btn")}}showMsg(t){t&&(this.DOMElements.alert.classList.remove("hide"),this.DOMElements.alert.innerHTML=t)}hideMsg(){this.DOMElements.alert.classList.add("hide")}showLogout(){this.DOMElements.logOutBtn.classList.remove("hide")}hideLogout(){this.DOMElements.logOutBtn.classList.add("hide")}getCredentials(){return{login:this.DOMElements.login.value,password:this.DOMElements.password.value}}},t)},gallery:()=>{t.initTemplate(e,"main-view");let s=new class{constructor(){this.events={}}subscribeEvent(t,e){this.events[t]=e}callEvent(t,e){this.events[t]&&this.events[t](e)}};new class{constructor(t,e,s,i){this.model=t,this.view=e,this.observer=s,this.utils=i,this.pageConfig={itemsPerPage:10,currentPage:0},this.init()}initListeners(){this.view.DOMElements.userList.addEventListener("click",this.tableLineHandler.bind(this)),this.view.DOMElements.search.addEventListener("keyup",this.searchHandler.bind(this)),this.view.DOMElements.emailDropdown.addEventListener("click",this.sortingHandler.bind(this)),this.view.DOMElements.roleDropdown.addEventListener("click",this.sortingHandler.bind(this)),this.view.DOMElements.nextBtn.addEventListener("click",this.getNextPageHandler.bind(this))}tableLineHandler(t){t.preventDefault();let e=t.target.getAttribute("data-row-id");e?this.openDetail(e):this.view.selectTableLine(t)}openDetail(t){this.model.getUserById(t).then(t=>{this.view.showSingleUser(t)})}searchHandler(t){t.preventDefault();let e=t.target.value;13===t.keyCode&&(0==e.length||e.length>2)&&(this.pageConfig.currentPage=0,this.view.clearList(),this.view.buildUsersList(this.getNextPage(),this.utils.sortingConfig.Find))}sortingHandler(t){t.preventDefault(),this.view.updateButtonText(t),this.applySortingMethod(this.view.getSortingType(t))}getNextPageHandler(t){t&&t.preventDefault(),this.view.buildUsersList(this.getNextPage()),this.isLastPage()}applySortingMethod(t){t&&(this.pageConfig.currentPage=0,this.view.clearList(),this.view.buildUsersList(this.getNextPage(),this.utils.sortingConfig[t]))}getNextPage(){let t=this.pageConfig.itemsPerPage*this.pageConfig.currentPage,e=this.pageConfig.itemsPerPage+t;return this.pageConfig.currentPage++,this.model.usersListData.slice(t,e)}isLastPage(){this.isMaxPage()&&(this.view.hideNextPage(),this.countStats())}isMaxPage(){return this.pageConfig.currentPage*this.pageConfig.itemsPerPage>=this.model.usersListData.length}countStats(){let t=this.model.usersListData.reduce((t,e)=>("Admin"==e.role?t.admins++:t.users++,t),{admins:0,users:0});this.view.showStats(t)}init(){this.model.getUserList().then(t=>{this.initListeners(),this.view.buildUsersList(this.getNextPage()),this.isLastPage()})}}(new class{constructor(){this.getUrl="http://localhost:3000/usersList",this.usersListData=[]}getUserList(){return fetch(this.getUrl).then(t=>t.json()).then(t=>(console.log("Data is loaded"),this.usersListData=t,t))}getUserById(t){return fetch(this.getUrl+"/"+t).then(t=>t.json()).then(t=>t)}saveUser(t){}updateUser(t){}},new class{constructor(){this.DOMElements={userList:document.querySelector("#user-list"),selectAll:document.querySelector("#select-all"),statsInfo:document.querySelector("#stats"),emailDropdown:document.querySelector("#dropdown-email"),roleDropdown:document.querySelector("#dropdown-role"),search:document.querySelector("#inputSearch"),nextBtn:document.querySelector("#next-page"),backBtn:document.querySelector("#back-btn"),usersList:document.querySelectorAll(".users-list"),singleUser:document.querySelector(".single-user"),singleUserDetails:document.querySelector("#single-user-details")},this.counter=0,this.DOMElements.selectAll.addEventListener("click",this.selectAllItems.bind(this)),this.DOMElements.backBtn.addEventListener("click",this.hideSingleUser.bind(this))}tableTemplate(t){return`<tr>\n\t\t<th scope="row">\n\t\t  <input type="checkbox">\n\t\t</th>\n\t\t<th scope="row">${t.id}</th>\n\t\t<td>${t.name}</td>\n\t\t<td>${t.username}</td>\n\t\t<td>${t.role}</td>\n\t\t<td>${t.email}</td>\n\t\t<td data-toggle="tooltip" title="${t.address.zipcode}, ${t.address.city}, ${t.address.street}">${t.address.city}</td>\n\t\t<td>${t.website}</td>\n\t\t<td>\n\t\t\t<div class="text-center">\n\t\t\t\t<a href="#" data-row-id="${t.id}" class="btn btn-primary btn-sm">Открыть</a>\n\t  \t\t</div>\n\t  </td>\n\t  </tr>`}singleUserTemplate(t){return`<form class="needs-validation" novalidate="">\n\t\t<div class="row">\n\t\t  <div class="col-md-6 mb-3">\n\t\t\t<label for="firstName">Имя</label>\n\t\t\t<input type="text" class="form-control" value="${t.name}" readonly>\n\t\t  </div>\n\t\t  <div class="col-md-6 mb-3">\n\t\t\t<label for="lastName">Роль</label>\n\t\t\t<input type="text" class="form-control" value="${t.role}" readonly>\n\t\t  </div>\n\t\t</div>\n\t\t<div class="mb-3">\n\t\t  <label for="username">Логин</label>\n\t\t  <div class="input-group">\n\t\t\t<div class="input-group-prepend">\n\t\t\t  <span class="input-group-text">@</span>\n\t\t\t</div>\n\t\t\t<input type="text" class="form-control" value="${t.username}" readonly>\n\t\t  </div>\n\t\t</div>\n\t\t<div class="mb-3">\n\t\t  <label for="email">Email <span class="text-muted">(Опционально)</span></label>\n\t\t  <input type="email" class="form-control" value="${t.email}" readonly>\n\t\t</div>\n\t\t<div class="mb-3">\n\t\t  <label for="address">Адрес</label>\n\t\t  <input type="text" class="form-control" value="${t.address.zipcode}, ${t.address.city}, ${t.address.street}" readonly>\n\t\t</div>\n\t\t<div class="mb-3">\n\t\t  <label for="address2">Сайт</label>\n\t\t  <input type="text" class="form-control" value="${t.website}" readonly>\n\t\t</div>\n\t  </form>`}selectAllItems(){this.DOMElements.userList.querySelectorAll("input[type=checkbox]").forEach(t=>this.DOMElements.selectAll.checked?t.checked=!0:t.checked=!1)}selectTableLine(t){t.currentTarget.querySelectorAll("tr").forEach(t=>t.classList.remove("table-active")),t.target.closest("tr").classList.add("table-active")}clearList(){this.DOMElements.userList.innerHTML="",this.hideNextPage()}updateButtonText(t){t.currentTarget.querySelector("button").innerHTML=t.target.innerText}getSortingType(t){return t.target.getAttribute("sorting-type")}blockNextPage(){this.DOMElements.nextBtn.classList.add("disabled")}hideNextPage(){this.DOMElements.nextBtn.classList.add("hide")}showStats(t){this.DOMElements.statsInfo.innerHTML=`Статистика системы. Админов: ${t.admins}, Пользователей: ${t.users}`}buildUsersList(t,e){e&&(t=e(t));let s=t.map(t=>this.tableTemplate(t));this.DOMElements.userList.innerHTML+=s.join("")}showSingleUser(t){this.DOMElements.usersList.forEach(t=>t.classList.add("hide")),this.DOMElements.singleUser.classList.remove("hide"),this.DOMElements.singleUserDetails.innerHTML=this.singleUserTemplate(t)}hideSingleUser(){this.DOMElements.singleUser.classList.add("hide"),this.DOMElements.usersList.forEach(t=>t.classList.remove("hide"))}},s,new t)},contacts:()=>{t.initTemplate(e,"contact-view"),console.log("Contacts route is loaded")}};function i(){let e=document.location.hash.replace(/^#/,"");e&&!t.isLoggedIn()?t.navigateTo(""):function(t){let e=s[t];e&&e()}(e)}window.addEventListener("load",i),window.addEventListener("hashchange",i)}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIiwicm91dGVyLmpzIiwibG9naW4vbG9naW4uY29udHJvbGxlci5qcyIsImxvZ2luL2xvZ2luLm1vZGVsLmpzIiwibG9naW4vbG9naW4udmlldy5qcyIsImdhbGxlcnkvb2JzZXJ2ZXIuanMiLCJnYWxsZXJ5L2dhbGxlcnkuY29udHJvbGxlci5qcyIsImdhbGxlcnkvZ2FsbGVyeS5tb2RlbC5qcyIsImdhbGxlcnkvZ2FsbGVyeS52aWV3LmpzIiwiYXBwLmpzIl0sIm5hbWVzIjpbIlV0aWxzIiwic29ydGluZ0NvbmZpZyIsInBhZ2UiLCJzb3J0IiwiYSIsImIiLCJlbWFpbCIsImZpbHRlciIsIml0ZW0iLCJyb2xlIiwiZXhwIiwiUmVnRXhwIiwiZXZlbnQiLCJ0YXJnZXQiLCJ2YWx1ZSIsInRlc3QiLCJuYW1lIiwid3JhcHBlckVsIiwidGVtcGxhdGVJZCIsImNsb24iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiaW5uZXJIVE1MIiwiYXBwZW5kQ2hpbGQiLCJyb3V0ZU5hbWUiLCJsb2NhdGlvbiIsImhhc2giLCJKU09OIiwicGFyc2UiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwid3JhcHBlciIsInJvdXRlQ29uZmlnIiwiaW5pdFRlbXBsYXRlIiwibW9kZWwiLCJ2aWV3IiwidXRpbHMiLCJpbml0TGlzdGVuZXJzIiwiRE9NRWxlbWVudHMiLCJsb2dJbkJ0biIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0aGlzIiwibG9naW5IYW5kbGVyIiwiYmluZCIsImxvZ091dEJ0biIsImxvZ291dEhhbmRsZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJjcmVkZW50aWFscyIsImdldENyZWRlbnRpYWxzIiwidmFsaWRhdGUiLCJsb2dpbiIsInRoZW4iLCJkYXRhIiwibG9naW5TdGF0dXMiLCJoaWRlTXNnIiwic2hvd0xvZ291dCIsIm5hdmlnYXRlVG8iLCJzaG93TXNnIiwiZ2V0RXJyb3JNc2ciLCJoaWRlTG9nb3V0IiwibG9nb3V0IiwibG9naW5VcmwiLCJlbWFpbFBhdHRlcm4iLCJwYXNzd29yZFBhdHRlcm4iLCJlcnJvck1zZyIsImVycm9yTXNnTWFwIiwiaXNFbXB0eSIsImlzRW1haWxBc3NlcnRQYXR0ZXJuIiwiaXNQYXNzd29yZEFzc2VydFBhdHRlcm4iLCJvcHRpb25zIiwic3RyaW5naWZ5IiwiZmV0Y2giLCJyZXNwb25jZSIsImpzb24iLCJzZXRJdGVtIiwic2V0RXJyb3JNc2ciLCJrZXkiLCJwYXNzd29yZCIsInJlbW92ZUl0ZW0iLCJtc2ciLCJhbGVydCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImFkZCIsIm9ic2VydmVyIiwiZXZlbnRzIiwiZnVuYyIsImFyZyIsInBhZ2VDb25maWciLCJpbml0IiwidXNlckxpc3QiLCJ0YWJsZUxpbmVIYW5kbGVyIiwic2VhcmNoIiwic2VhcmNoSGFuZGxlciIsImVtYWlsRHJvcGRvd24iLCJzb3J0aW5nSGFuZGxlciIsInJvbGVEcm9wZG93biIsIm5leHRCdG4iLCJnZXROZXh0UGFnZUhhbmRsZXIiLCJpc0J1dHRvbiIsImdldEF0dHJpYnV0ZSIsIm9wZW5EZXRhaWwiLCJzZWxlY3RUYWJsZUxpbmUiLCJidXR0b25JZCIsImdldFVzZXJCeUlkIiwic2hvd1NpbmdsZVVzZXIiLCJrZXlDb2RlIiwibGVuZ3RoIiwiY3VycmVudFBhZ2UiLCJjbGVhckxpc3QiLCJidWlsZFVzZXJzTGlzdCIsImdldE5leHRQYWdlIiwidXBkYXRlQnV0dG9uVGV4dCIsImFwcGx5U29ydGluZ01ldGhvZCIsImdldFNvcnRpbmdUeXBlIiwiaXNMYXN0UGFnZSIsInNvcnRpbmdUeXBlIiwic3RhcnQiLCJpdGVtc1BlclBhZ2UiLCJlbmQiLCJ1c2Vyc0xpc3REYXRhIiwic2xpY2UiLCJpc01heFBhZ2UiLCJoaWRlTmV4dFBhZ2UiLCJjb3VudFN0YXRzIiwic3RhdHMiLCJyZWR1Y2UiLCJzdW0iLCJhZG1pbnMiLCJ1c2VycyIsInNob3dTdGF0cyIsImdldFVzZXJMaXN0IiwiZ2V0VXJsIiwibG9nIiwiaWQiLCJjb3VudGVyIiwicXVlcnlTZWxlY3RvckFsbCIsInNlbGVjdEFsbCIsInNlbGVjdEFsbEl0ZW1zIiwiYmFja0J0biIsImhpZGVTaW5nbGVVc2VyIiwidXNlcm5hbWUiLCJhZGRyZXNzIiwiemlwY29kZSIsImNpdHkiLCJzdHJlZXQiLCJ3ZWJzaXRlIiwiZm9yRWFjaCIsImNoZWNrZWQiLCJjdXJyZW50VGFyZ2V0IiwiY2xvc2VzdCIsImlubmVyVGV4dCIsInN0YXRzSW5mbyIsImZpbHRlclNvcnRGdW5jdGlvbiIsInJlc3VsdCIsIm1hcCIsInRhYmxlVGVtcGxhdGUiLCJqb2luIiwidXNlcnNMaXN0Iiwic2luZ2xlVXNlciIsInNpbmdsZVVzZXJEZXRhaWxzIiwic2luZ2xlVXNlclRlbXBsYXRlIiwidXBkYXRlUm91dGUiLCJyZXBsYWNlIiwiaXNMb2dnZWRJbiIsInJvdXRlIiwid2luZG93Il0sIm1hcHBpbmdzIjoiK0JBQXFCQSxxQkFJUkMsaUJBRUlDLE1BQ0lDLEtBQUssQ0FBQ0MsRUFBR0MsSUFDSEQsRUFBRUUsTUFBUUQsRUFBRUMsTUFBUSxHQUFLLEdBRTdCSixLQUVOQSxNQUNJQyxLQUFLLENBQUNDLEVBQUdDLElBQ0hELEVBQUVFLE1BQVFELEVBQUVDLE1BQVEsR0FBSyxHQUU3QkosU0FFRkEsR0FDRUEsRUFBS0ssT0FBUUMsR0FDSSxTQUFiQSxFQUFLQyxXQUdaUCxHQUNHQSxFQUFLSyxPQUFRQyxHQUNJLFFBQWJBLEVBQUtDLFdBR1pQLFFBQ0FRLEVBQU0sSUFBSUMsT0FBT0MsTUFBTUMsT0FBT0MsTUFBTyxZQUNsQ1osRUFBS0ssT0FBT0MsR0FDUkUsRUFBSUssS0FBS1AsRUFBS1EsNkJBTWpCQyxFQUFXQyxPQUV2QkMsRUFEV0MsU0FBU0Msa0JBQWtCSCxLQUN0QkksUUFBUUMsV0FBVSxLQUM1QkMsVUFBWSxLQUNaQyxZQUFZTixxQkFHUk8sVUFDUEMsU0FBU0MsU0FBV0YsZ0NBSVRHLEtBQUtDLE1BQU1DLGFBQWFDLFFBQVEsaUJDdkMxRCxNQUFNQyxFQUFVYixT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WUFBWXFELFNBQVNyRSxXQUFhcUksRUFBT0csS0FBSyxtQkFHbEN4SixRQUNOZ0MsWUFBWXlILFVBQVVYLFFBQVE5SSxHQUFRQSxFQUFLNEUsVUFBVUUsSUFBSSxjQUN6RDlDLFlBQVkwSCxXQUFXOUUsVUFBVUMsT0FBTyxhQUN4QzdDLFlBQVkySCxrQkFBa0IzSSxVQUFZbUIsS0FBS3lILG1CQUFtQjVKLHlCQUlsRWdDLFlBQVkwSCxXQUFXOUUsVUFBVUUsSUFBSSxhQUNyQzlDLFlBQVl5SCxVQUFVWCxRQUFROUksR0FBUUEsRUFBSzRFLFVBQVVDLE9BQU8sV1AxRzlCRSxFQUFVLElBQUlqRCxhQUV4QyxPQUNISCxhQUFhRixFQUFTLHdCQUNwQnVHLElBQUksOEJBVXBCLFNBQWdCNkIsUUFDUjNJLEVBQVlOLFNBQVNPLFNBQVNDLEtBQUswSSxRQUFRLEtBQU0sSUFDbEQ1SSxJQUFjWSxFQUFNaUksZUFDYjVHLFdBQVcsSUFSekIsU0FBdUJqQyxPQUNmOEksRUFBUXRJLEVBQVlSLE1BQ2Y4SSxLQVFTOUksR1F6Q3RCK0ksT0FBTy9ILGlCQUFpQixPQUFRMkgsR0FDaENJLE9BQU8vSCxpQkFBaUIsYUFBYzJIIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBVdGlscyB7XG5cbiAgICBjb25zdHJ1Y3Rvcigpe1xuXG4gICAgICAgIHRoaXMuc29ydGluZ0NvbmZpZyA9IHtcbiAgICAgICAgICBcbiAgICAgICAgICAgIFwiQVwiOiBwYWdlID0+IHtcbiAgICAgICAgICAgICAgICBwYWdlLnNvcnQoKGEsIGIpID0+e1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5lbWFpbCA+IGIuZW1haWwgPyAxIDogLTE7XG4gICAgICAgICAgICAgICAgfSk7IFxuICAgICAgICAgICAgICAgIHJldHVybiBwYWdlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiWlwiOiBwYWdlID0+IHtcbiAgICAgICAgICAgICAgICBwYWdlLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuZW1haWwgPCBiLmVtYWlsID8gMSA6IC0xOztcbiAgICAgICAgICAgICAgICB9KTsgXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhZ2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJBZG1pblwiOiBwYWdlID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFnZS5maWx0ZXIoKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ucm9sZSA9PSBcIkFkbWluXCI7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIlVzZXJcIjogcGFnZSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhZ2UuZmlsdGVyKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnJvbGUgPT0gXCJVc2VyXCI7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIkZpbmRcIjogcGFnZSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGV4cCA9IG5ldyBSZWdFeHAoZXZlbnQudGFyZ2V0LnZhbHVlLCBcImlcIilcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFnZS5maWx0ZXIoaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBleHAudGVzdChpdGVtLm5hbWUpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgaW5pdFRlbXBsYXRlKHdyYXBwZXJFbCwgdGVtcGxhdGVJZCkge1xuICAgICAgICB2YXIgdGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHt0ZW1wbGF0ZUlkfWApO1xuICAgICAgICB2YXIgY2xvbiA9IHRlbXBsYXRlLmNvbnRlbnQuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgICB3cmFwcGVyRWwuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIHdyYXBwZXJFbC5hcHBlbmRDaGlsZChjbG9uKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgbmF2aWdhdGVUbyhyb3V0ZU5hbWUpIHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBgIyR7cm91dGVOYW1lfWA7XG4gICAgfVxuXG4gICAgc3RhdGljIGlzTG9nZ2VkSW4oKSB7XG4gICAgICAgIGxldCBjcmVkZW50aWFscyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2NyZWRlbnRpYWxzJykpO1xuICAgICAgICByZXR1cm4gISFjcmVkZW50aWFscztcbiAgICB9XG5cbiBcblxufVxuIiwiaW1wb3J0IHV0aWxzIGZyb20gJy4vdXRpbHMuanMnO1xuaW1wb3J0IE9ic2VydmVyIGZyb20gJy4vZ2FsbGVyeS9vYnNlcnZlci5qcyc7XG5pbXBvcnQgR2FsbGVyeUNvbnRyb2xsZXIgZnJvbSAnLi9nYWxsZXJ5L2dhbGxlcnkuY29udHJvbGxlci5qcyc7XG5pbXBvcnQgR2FsbGVyeU1vZGVsIGZyb20gJy4vZ2FsbGVyeS9nYWxsZXJ5Lm1vZGVsLmpzJztcbmltcG9ydCBHYWxsZXJ5VmlldyBmcm9tICcuL2dhbGxlcnkvZ2FsbGVyeS52aWV3LmpzJztcblxuaW1wb3J0IExvZ2luQ29udHJvbGxlciBmcm9tICcuL2xvZ2luL2xvZ2luLmNvbnRyb2xsZXIuanMnO1xuaW1wb3J0IExvZ2luTW9kZWwgZnJvbSAnLi9sb2dpbi9sb2dpbi5tb2RlbC5qcyc7XG5pbXBvcnQgTG9naW5WaWV3IGZyb20gJy4vbG9naW4vbG9naW4udmlldy5qcyc7XG5cbmNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3dyYXBwZXJcIik7XG5cbmxldCByb3V0ZUNvbmZpZyA9IHtcbiAgICBcIlwiIDogKCkgPT4ge1xuICAgICAgICB1dGlscy5pbml0VGVtcGxhdGUod3JhcHBlciwgXCJsb2dpbi12aWV3XCIpO1xuICAgICAgICBsZXQgbW9kZWwgPSBuZXcgTG9naW5Nb2RlbDtcbiAgICAgICAgbGV0IHZpZXcgPSBuZXcgTG9naW5WaWV3O1xuICAgICAgICBuZXcgTG9naW5Db250cm9sbGVyKG1vZGVsLCB2aWV3LCB1dGlscylcbiAgICB9LFxuICAgIFwiZ2FsbGVyeVwiIDogKCkgPT4ge1xuICAgICAgICB1dGlscy5pbml0VGVtcGxhdGUod3JhcHBlciwgXCJtYWluLXZpZXdcIik7XG4gICAgICAgIGxldCBvYnNlcnZlciA9IG5ldyBPYnNlcnZlcjtcbiAgICAgICAgbGV0IG1vZGVsID0gbmV3IEdhbGxlcnlNb2RlbDtcbiAgICAgICAgbGV0IHZpZXcgPSBuZXcgR2FsbGVyeVZpZXc7XG4gICAgICAgIG5ldyBHYWxsZXJ5Q29udHJvbGxlcihtb2RlbCwgdmlldywgb2JzZXJ2ZXIsIG5ldyB1dGlscylcbiAgICB9LFxuICAgIFwiY29udGFjdHNcIiA6ICgpID0+IHtcbiAgICAgICAgdXRpbHMuaW5pdFRlbXBsYXRlKHdyYXBwZXIsIFwiY29udGFjdC12aWV3XCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIkNvbnRhY3RzIHJvdXRlIGlzIGxvYWRlZFwiKVxuICAgICAgICAvL2ltcGxlbWVudCBDb250cm9sbGVyLCBWaWV3IGFuZCBNb2RlbCBmb3IgdGhpcyBSb3V0ZVxuICAgIH1cbn1cblxuZnVuY3Rpb24gYWN0aXZhdGVSb3V0ZShyb3V0ZU5hbWUpe1xuICAgIGxldCByb3V0ZSA9IHJvdXRlQ29uZmlnW3JvdXRlTmFtZV07XG4gICAgcm91dGUgJiYgcm91dGUoKTsgICAgXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVSb3V0ZSgpIHtcbiAgICBsZXQgcm91dGVOYW1lID0gZG9jdW1lbnQubG9jYXRpb24uaGFzaC5yZXBsYWNlKC9eIy8sICcnKTtcbiAgICBpZihyb3V0ZU5hbWUgJiYgIXV0aWxzLmlzTG9nZ2VkSW4oKSkge1xuICAgICAgICB1dGlscy5uYXZpZ2F0ZVRvKFwiXCIpOyBcbiAgICB9IGVsc2Uge1xuICAgICAgICBhY3RpdmF0ZVJvdXRlKHJvdXRlTmFtZSk7XG4gICAgfVxuICAgIFxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9naW5Db250cm9sbGVyIHsgXHJcbiAgICBjb25zdHJ1Y3Rvcihtb2RlbCwgdmlldywgdXRpbHMpIHtcclxuICAgICAgICB0aGlzLm1vZGVsID0gbW9kZWw7XHJcbiAgICAgICAgdGhpcy52aWV3ID0gdmlldztcclxuICAgICAgICB0aGlzLnV0aWxzID0gdXRpbHM7XHJcbiAgICAgICAgdGhpcy5pbml0TGlzdGVuZXJzKCk7XHJcbiAgICB9IFxyXG5cclxuICAgIGluaXRMaXN0ZW5lcnMoKSB7IFxyXG4gICAgICAgIHRoaXMudmlldy5ET01FbGVtZW50cy5sb2dJbkJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5sb2dpbkhhbmRsZXIuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgdGhpcy52aWV3LkRPTUVsZW1lbnRzLmxvZ091dEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5sb2dvdXRIYW5kbGVyLmJpbmQodGhpcykpO1xyXG4gICAgfVxyXG5cclxuICAgIGxvZ2luSGFuZGxlcihlKSB7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGxldCBjcmVkZW50aWFscyA9IHRoaXMudmlldy5nZXRDcmVkZW50aWFscygpO1xyXG4gICAgICAgIGlmICh0aGlzLm1vZGVsLnZhbGlkYXRlKGNyZWRlbnRpYWxzKSl7XHJcbiAgICAgICAgICAgIHRoaXMubW9kZWwubG9naW4oY3JlZGVudGlhbHMpLnRoZW4oXHJcbiAgICAgICAgICAgICAgICBkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5sb2dpblN0YXR1cyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlldy5oaWRlTXNnKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlldy5zaG93TG9nb3V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXRpbHMubmF2aWdhdGVUbyhcImdhbGxlcnlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3LnNob3dNc2codGhpcy5tb2RlbC5nZXRFcnJvck1zZygpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy52aWV3LnNob3dNc2codGhpcy5tb2RlbC5nZXRFcnJvck1zZygpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbG9nb3V0SGFuZGxlcigpIHtcclxuICAgICAgICB0aGlzLnZpZXcuaGlkZUxvZ291dCgpO1xyXG4gICAgICAgIHRoaXMubW9kZWwubG9nb3V0KCk7XHJcbiAgICAgICAgdGhpcy51dGlscy5uYXZpZ2F0ZVRvKFwiXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vaW5pdCgpIHsgfVxyXG4gICAgXHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9naW5Nb2RlbCB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5sb2dpblVybCA9IFwiaHR0cDovL2xvY2FsaG9zdDozMDAwL2xvZ2luXCI7XHJcbiAgICAgICAgdGhpcy5lbWFpbFBhdHRlcm4gPSAvXlxcdytAXFx3K1xcLlxcd3syLDR9JC9pO1xyXG4gICAgICAgIHRoaXMucGFzc3dvcmRQYXR0ZXJuID0gL15bYS16QS1aMC05XXs4LDMwfSQvO1xyXG4gICAgICAgIHRoaXMuZXJyb3JNc2cgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZXJyb3JNc2dNYXAgPSB7XHJcbiAgICAgICAgICAgIFwiZW1wdHlcIiAgICAgOiAn0J/QvtC20LDQu9GD0LnRgdGC0LAg0LfQsNC/0L7Qu9C90LjRgtC1INC/0L7Qu9GPINC70L7Qs9C40L0g0Lgg0L/QsNGA0L7Qu9GMJyxcclxuICAgICAgICAgICAgXCJsb2dpbkVycm9yXCI6ICfQm9C+0LPQuNC9INCy0LLQtdC00LXQvSDQvdC10LLQtdGA0L3Qvi4g0KLQvtC70YzQutC+INC70LDRgtC40L3RgdC60LjQtSDQsdGD0LrQstGLLicsXHJcbiAgICAgICAgICAgIFwicGFzc0Vycm9yXCIgOiAn0J/QsNGA0L7Qu9GMINCy0LLQtdC00LXQvSDQvdC10LLQtdGA0L3Qvi4g0KLQvtC70YzQuiDQu9Cw0YLQuNC90YHQutC40LUg0LHRg9C60LLRiywg0YbQuNGE0YDRiy4g0JTQu9C40L3QsCDQvdC1INC80LXQvdC10LUgOCDRgdC40LzQstC+0LvQvtCyJyxcclxuICAgICAgICAgICAgXCJtaXNzbWF0Y2hcIiA6ICfQndC10L/RgNCw0LLQuNC70YzQvdGL0LUg0LvQvtCz0LjQvSDQuNC70Lgg0L/QsNGA0L7Qu9GMLidcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHZhbGlkYXRlKGNyZWRlbnRpYWxzKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNFbXB0eShjcmVkZW50aWFscykgXHJcbiAgICAgICAgICAgICYmIHRoaXMuaXNFbWFpbEFzc2VydFBhdHRlcm4oY3JlZGVudGlhbHMpIFxyXG4gICAgICAgICAgICAmJiB0aGlzLmlzUGFzc3dvcmRBc3NlcnRQYXR0ZXJuKGNyZWRlbnRpYWxzKTsgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIGxvZ2luKGNyZWRlbnRpYWxzKXtcclxuICAgICAgICBsZXQgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoY3JlZGVudGlhbHMpXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZmV0Y2godGhpcy5sb2dpblVybCwgb3B0aW9ucylcclxuICAgICAgICAgICAgLnRoZW4ocmVzcG9uY2UgPT4gcmVzcG9uY2UuanNvbigpKVxyXG4gICAgICAgICAgICAudGhlbihkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChkYXRhLmxvZ2luU3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NyZWRlbnRpYWxzJywgSlNPTi5zdHJpbmdpZnkoY3JlZGVudGlhbHMpKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRFcnJvck1zZyhcIm1pc3NtYXRjaFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZ2V0RXJyb3JNc2coKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JNc2c7XHJcbiAgICB9XHJcbiAgICBzZXRFcnJvck1zZyhrZXkpe1xyXG4gICAgICAgIHRoaXMuZXJyb3JNc2cgPSB0aGlzLmVycm9yTXNnTWFwW2tleV07XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaXNFbXB0eShjcmVkZW50aWFscykge1xyXG4gICAgICAgIHJldHVybiAoY3JlZGVudGlhbHMubG9naW4gJiYgY3JlZGVudGlhbHMucGFzc3dvcmQpIHx8IHRoaXMuc2V0RXJyb3JNc2coXCJlbXB0eVwiKTtcclxuICAgIH1cclxuICAgIGlzRW1haWxBc3NlcnRQYXR0ZXJuKGNyZWRlbnRpYWxzKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZW1haWxQYXR0ZXJuLnRlc3QoY3JlZGVudGlhbHMubG9naW4pIHx8IHRoaXMuc2V0RXJyb3JNc2coXCJsb2dpbkVycm9yXCIpXHJcbiAgICB9XHJcbiAgICBpc1Bhc3N3b3JkQXNzZXJ0UGF0dGVybihjcmVkZW50aWFscykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhc3N3b3JkUGF0dGVybi50ZXN0KGNyZWRlbnRpYWxzLnBhc3N3b3JkKSB8fCB0aGlzLnNldEVycm9yTXNnKFwicGFzc0Vycm9yXCIpXHJcbiAgICB9XHJcbiAgICBcclxuICAgIGxvZ291dCgpe1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdjcmVkZW50aWFscycpO1xyXG4gICAgfVxyXG5cclxufVxyXG4gXHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIExvZ2luVmlldyAgeyAgICAgICAgXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLkRPTUVsZW1lbnRzID0ge1xyXG4gICAgICAgICAgICBsb2dpbjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2lucHV0RW1haWwnKSxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNpbnB1dFBhc3N3b3JkJyksXHJcbiAgICAgICAgICAgIGFsZXJ0OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWxlcnQnKSxcclxuXHJcbiAgICAgICAgICAgIGxvZ0luQnRuOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbG9nLWluLWJ0bicpLFxyXG4gICAgICAgICAgICBsb2dPdXRCdG46IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNsb2ctb3V0LWJ0bicpLFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzaG93TXNnKG1zZykge1xyXG4gICAgICAgIGlmIChtc2cpIHtcclxuICAgICAgICAgICAgdGhpcy5ET01FbGVtZW50cy5hbGVydC5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZVwiKTtcclxuICAgICAgICAgICAgdGhpcy5ET01FbGVtZW50cy5hbGVydC5pbm5lckhUTUwgPSBtc2c7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGhpZGVNc2coKSB7XHJcbiAgICAgICAgdGhpcy5ET01FbGVtZW50cy5hbGVydC5jbGFzc0xpc3QuYWRkKFwiaGlkZVwiKTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93TG9nb3V0KCkge1xyXG4gICAgICAgIHRoaXMuRE9NRWxlbWVudHMubG9nT3V0QnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRlXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGhpZGVMb2dvdXQoKSB7XHJcbiAgICAgICAgdGhpcy5ET01FbGVtZW50cy5sb2dPdXRCdG4uY2xhc3NMaXN0LmFkZChcImhpZGVcIik7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q3JlZGVudGlhbHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbG9naW46IHRoaXMuRE9NRWxlbWVudHMubG9naW4udmFsdWUsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLkRPTUVsZW1lbnRzLnBhc3N3b3JkLnZhbHVlXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG4gICAgIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgT2JzZXJ2ZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmV2ZW50cyA9IHt9O1xuICAgIH1cblxuICAgIHN1YnNjcmliZUV2ZW50KG5hbWUsIGZ1bmMpIHtcbiAgICAgICAgdGhpcy5ldmVudHNbbmFtZV0gPSBmdW5jO1xuICAgIH1cbiAgICBcbiAgICBjYWxsRXZlbnQobmFtZSwgYXJnKSB7XG4gICAgICAgIGlmICh0aGlzLmV2ZW50c1tuYW1lXSkge1xuICAgICAgICAgICAgdGhpcy5ldmVudHNbbmFtZV0oYXJnKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbGxlcnlDb250cm9sbGVyIHsgXHJcbiAgICBjb25zdHJ1Y3Rvcihtb2RlbCwgdmlldywgb2JzZXJ2ZXIsIHV0aWxzKSB7XHJcbiAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xyXG4gICAgICAgIHRoaXMudmlldyA9IHZpZXc7XHJcbiAgICAgICAgdGhpcy5vYnNlcnZlciA9IG9ic2VydmVyO1xyXG4gICAgICAgIHRoaXMudXRpbHMgPSB1dGlscztcclxuICAgICAgICB0aGlzLnBhZ2VDb25maWcgPSB7XHJcbiAgICAgICAgICAgIGl0ZW1zUGVyUGFnZSA6IDEwLFxyXG5cdFx0XHRjdXJyZW50UGFnZTogMFxyXG5cdFx0fVxyXG4gICAgICAgIHRoaXMuaW5pdCgpO1xyXG4gICAgfSAgICAgICAgXHJcblxyXG4gICAgaW5pdExpc3RlbmVycygpIHtcclxuXHRcdHRoaXMudmlldy5ET01FbGVtZW50cy51c2VyTGlzdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy50YWJsZUxpbmVIYW5kbGVyLmJpbmQodGhpcykpO1xyXG5cdFx0XHJcblx0XHR0aGlzLnZpZXcuRE9NRWxlbWVudHMuc2VhcmNoLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLnNlYXJjaEhhbmRsZXIuYmluZCh0aGlzKSk7XHJcblx0XHR0aGlzLnZpZXcuRE9NRWxlbWVudHMuZW1haWxEcm9wZG93bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5zb3J0aW5nSGFuZGxlci5iaW5kKHRoaXMpKTtcclxuXHRcdHRoaXMudmlldy5ET01FbGVtZW50cy5yb2xlRHJvcGRvd24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuc29ydGluZ0hhbmRsZXIuYmluZCh0aGlzKSk7XHJcblx0XHRcclxuICAgICAgICB0aGlzLnZpZXcuRE9NRWxlbWVudHMubmV4dEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5nZXROZXh0UGFnZUhhbmRsZXIuYmluZCh0aGlzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGFibGVMaW5lSGFuZGxlcihldmVudCkge1xyXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRsZXQgaXNCdXR0b24gPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS1yb3ctaWRcIik7XHJcblx0XHRpc0J1dHRvbiA/IHRoaXMub3BlbkRldGFpbChpc0J1dHRvbikgOiB0aGlzLnZpZXcuc2VsZWN0VGFibGVMaW5lKGV2ZW50KTtcclxuXHR9XHJcblxyXG5cdG9wZW5EZXRhaWwoYnV0dG9uSWQpIHtcclxuXHRcdGxldCB1c2VyID0gdGhpcy5tb2RlbC5nZXRVc2VyQnlJZChidXR0b25JZCkudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnZpZXcuc2hvd1NpbmdsZVVzZXIoZGF0YSk7XHJcbiAgICAgICAgfSk7IFx0XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHNlYXJjaEhhbmRsZXIoZXZlbnQpIHtcclxuXHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRsZXQgdmFsdWUgPSBldmVudC50YXJnZXQudmFsdWU7XHJcblx0XHRpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMgJiYgKHZhbHVlLmxlbmd0aCA9PSAwIHx8IHZhbHVlLmxlbmd0aCA+IDIpKSB7XHJcblx0XHRcdHRoaXMucGFnZUNvbmZpZy5jdXJyZW50UGFnZSA9IDA7XHJcbiAgICAgICAgICAgIHRoaXMudmlldy5jbGVhckxpc3QoKTtcclxuXHRcdFx0dGhpcy52aWV3LmJ1aWxkVXNlcnNMaXN0KHRoaXMuZ2V0TmV4dFBhZ2UoKSwgdGhpcy51dGlscy5zb3J0aW5nQ29uZmlnW1wiRmluZFwiXSk7XHJcblx0XHQgfVxyXG5cdH1cclxuXHJcblx0c29ydGluZ0hhbmRsZXIoZXZlbnQpIHtcclxuXHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHR0aGlzLnZpZXcudXBkYXRlQnV0dG9uVGV4dChldmVudCk7XHJcblx0XHR0aGlzLmFwcGx5U29ydGluZ01ldGhvZCh0aGlzLnZpZXcuZ2V0U29ydGluZ1R5cGUoZXZlbnQpKTtcclxuXHR9XHJcbiAgICBcclxuICAgIGdldE5leHRQYWdlSGFuZGxlcihldmVudCkge1xyXG4gICAgICAgIGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgdGhpcy52aWV3LmJ1aWxkVXNlcnNMaXN0KHRoaXMuZ2V0TmV4dFBhZ2UoKSk7XHJcbiAgICAgICAgdGhpcy5pc0xhc3RQYWdlKCk7IFxyXG4gICAgfVxyXG5cclxuXHRhcHBseVNvcnRpbmdNZXRob2Qoc29ydGluZ1R5cGUpIHtcclxuICAgICAgICBpZiAoIXNvcnRpbmdUeXBlKXtyZXR1cm59XHJcblx0XHR0aGlzLnBhZ2VDb25maWcuY3VycmVudFBhZ2UgPSAwO1xyXG4gICAgICAgIHRoaXMudmlldy5jbGVhckxpc3QoKTtcclxuXHRcdHRoaXMudmlldy5idWlsZFVzZXJzTGlzdCh0aGlzLmdldE5leHRQYWdlKCksIHRoaXMudXRpbHMuc29ydGluZ0NvbmZpZ1tzb3J0aW5nVHlwZV0pO1xyXG5cdH1cclxuXHJcbiAgICBnZXROZXh0UGFnZSgpe1xyXG5cdFx0bGV0IHN0YXJ0ID0gdGhpcy5wYWdlQ29uZmlnLml0ZW1zUGVyUGFnZSAqIHRoaXMucGFnZUNvbmZpZy5jdXJyZW50UGFnZTtcclxuXHRcdGxldCBlbmQgPSB0aGlzLnBhZ2VDb25maWcuaXRlbXNQZXJQYWdlICsgc3RhcnQ7XHJcblx0XHR0aGlzLnBhZ2VDb25maWcuY3VycmVudFBhZ2UrKztcclxuXHRcdHJldHVybiB0aGlzLm1vZGVsLnVzZXJzTGlzdERhdGEuc2xpY2Uoc3RhcnQsIGVuZCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlzTGFzdFBhZ2UoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNNYXhQYWdlKCkpe1xyXG4gICAgICAgICAgICB0aGlzLnZpZXcuaGlkZU5leHRQYWdlKCk7XHRcclxuICAgICAgICAgICAgdGhpcy5jb3VudFN0YXRzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHRpc01heFBhZ2UoKSB7XHJcblx0XHRyZXR1cm4gKHRoaXMucGFnZUNvbmZpZy5jdXJyZW50UGFnZSAqIHRoaXMucGFnZUNvbmZpZy5pdGVtc1BlclBhZ2UpID49IHRoaXMubW9kZWwudXNlcnNMaXN0RGF0YS5sZW5ndGg7XHJcblx0fVxyXG5cclxuXHRjb3VudFN0YXRzKCl7XHJcblx0XHRsZXQgc3RhdHMgPSB0aGlzLm1vZGVsLnVzZXJzTGlzdERhdGEucmVkdWNlKChzdW0sIGl0ZW0pID0+IHtcclxuXHRcdFx0KGl0ZW0ucm9sZSA9PSBcIkFkbWluXCIpID8gc3VtLmFkbWlucysrIDpcdHN1bS51c2VycysrO1xyXG5cdFx0XHRyZXR1cm4gc3VtO1xyXG5cdFx0fSwge2FkbWluczowLCB1c2VyczowfSk7XHJcblx0XHR0aGlzLnZpZXcuc2hvd1N0YXRzKHN0YXRzKTtcclxuXHR9XHJcblx0XHJcblx0aW5pdCgpe1xyXG4gICAgICAgIHRoaXMubW9kZWwuZ2V0VXNlckxpc3QoKS50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdExpc3RlbmVycygpXHJcbiAgICAgICAgICAgIHRoaXMudmlldy5idWlsZFVzZXJzTGlzdCh0aGlzLmdldE5leHRQYWdlKCkpO1xyXG4gICAgICAgICAgICB0aGlzLmlzTGFzdFBhZ2UoKTtcclxuICAgICAgICB9KTsgXHRcclxuXHR9XHJcbiAgICBcclxufVxyXG5cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FsbGVyeU1vZGVsIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuZ2V0VXJsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC91c2Vyc0xpc3QnO1xyXG4gICAgICAgIHRoaXMudXNlcnNMaXN0RGF0YSA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFVzZXJMaXN0KCkge1xyXG4gICAgICAgIHJldHVybiBmZXRjaCh0aGlzLmdldFVybCkudGhlbihyZXNwb25jZSA9PiByZXNwb25jZS5qc29uKCkpXHJcbiAgICAgICAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRGF0YSBpcyBsb2FkZWRcIik7XHJcbiAgICAgICAgICAgIHRoaXMudXNlcnNMaXN0RGF0YSA9IGRhdGE7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgIH0pICAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VXNlckJ5SWQoaWQpIHtcclxuICAgICAgcmV0dXJuIGZldGNoKHRoaXMuZ2V0VXJsICsgXCIvXCIgKyBpZCkudGhlbihyZXNwb25jZSA9PiByZXNwb25jZS5qc29uKCkpXHJcbiAgICAgIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgIH0pICAgICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHNhdmVVc2VyKGl0ZW0pIHsgICAgICAgICBcclxuXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHVwZGF0ZVVzZXIoY291bnRlcikge1xyXG4gICAgICBcclxuICAgIH1cclxuXHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FsbGVyeVZpZXcgeyAgICAgICAgXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLkRPTUVsZW1lbnRzID0ge1xyXG4gICAgICAgICAgICB1c2VyTGlzdCA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjdXNlci1saXN0XCIpLFxyXG4gICAgICAgICAgICBzZWxlY3RBbGwgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3NlbGVjdC1hbGxcIiksXHJcbiAgICAgICAgICAgIHN0YXRzSW5mbyA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjc3RhdHNcIiksXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBlbWFpbERyb3Bkb3duIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkcm9wZG93bi1lbWFpbFwiKSxcclxuICAgICAgICAgICAgcm9sZURyb3Bkb3duIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkcm9wZG93bi1yb2xlXCIpLFxyXG4gICAgICAgICAgICBzZWFyY2ggOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2lucHV0U2VhcmNoXCIpLFxyXG4gICAgICAgICAgICBuZXh0QnRuIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXh0LXBhZ2VcIiksXHJcbiAgICAgICAgICAgIGJhY2tCdG4gOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2JhY2stYnRuXCIpLFxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHVzZXJzTGlzdCA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudXNlcnMtbGlzdFwiKSxcclxuICAgICAgICAgICAgc2luZ2xlVXNlciA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2luZ2xlLXVzZXJcIiksXHJcbiAgICAgICAgICAgIHNpbmdsZVVzZXJEZXRhaWxzIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzaW5nbGUtdXNlci1kZXRhaWxzXCIpICBcclxuICAgICAgICB9OyAgICAgXHJcbiAgICAgICAgdGhpcy5jb3VudGVyID0gMDtcclxuICAgICAgICB0aGlzLkRPTUVsZW1lbnRzLnNlbGVjdEFsbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5zZWxlY3RBbGxJdGVtcy5iaW5kKHRoaXMpKTtcclxuICAgICAgICB0aGlzLkRPTUVsZW1lbnRzLmJhY2tCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuaGlkZVNpbmdsZVVzZXIuYmluZCh0aGlzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGFibGVUZW1wbGF0ZSAoaXRlbSkge1xyXG5cdFx0cmV0dXJuIFx0YDx0cj5cclxuXHRcdDx0aCBzY29wZT1cInJvd1wiPlxyXG5cdFx0ICA8aW5wdXQgdHlwZT1cImNoZWNrYm94XCI+XHJcblx0XHQ8L3RoPlxyXG5cdFx0PHRoIHNjb3BlPVwicm93XCI+JHtpdGVtLmlkfTwvdGg+XHJcblx0XHQ8dGQ+JHtpdGVtLm5hbWV9PC90ZD5cclxuXHRcdDx0ZD4ke2l0ZW0udXNlcm5hbWV9PC90ZD5cclxuXHRcdDx0ZD4ke2l0ZW0ucm9sZX08L3RkPlxyXG5cdFx0PHRkPiR7aXRlbS5lbWFpbH08L3RkPlxyXG5cdFx0PHRkIGRhdGEtdG9nZ2xlPVwidG9vbHRpcFwiIHRpdGxlPVwiJHtpdGVtLmFkZHJlc3MuemlwY29kZX0sICR7aXRlbS5hZGRyZXNzLmNpdHl9LCAke2l0ZW0uYWRkcmVzcy5zdHJlZXR9XCI+JHtpdGVtLmFkZHJlc3MuY2l0eX08L3RkPlxyXG5cdFx0PHRkPiR7aXRlbS53ZWJzaXRlfTwvdGQ+XHJcblx0XHQ8dGQ+XHJcblx0XHRcdDxkaXYgY2xhc3M9XCJ0ZXh0LWNlbnRlclwiPlxyXG5cdFx0XHRcdDxhIGhyZWY9XCIjXCIgZGF0YS1yb3ctaWQ9XCIke2l0ZW0uaWR9XCIgY2xhc3M9XCJidG4gYnRuLXByaW1hcnkgYnRuLXNtXCI+0J7RgtC60YDRi9GC0Yw8L2E+XHJcblx0ICBcdFx0PC9kaXY+XHJcblx0ICA8L3RkPlxyXG5cdCAgPC90cj5gO1xyXG4gICAgfTtcclxuICAgIFxyXG5cclxuXHRzaW5nbGVVc2VyVGVtcGxhdGUgKGl0ZW0pIHtcclxuXHRcdHJldHVybiBcdGA8Zm9ybSBjbGFzcz1cIm5lZWRzLXZhbGlkYXRpb25cIiBub3ZhbGlkYXRlPVwiXCI+XHJcblx0XHQ8ZGl2IGNsYXNzPVwicm93XCI+XHJcblx0XHQgIDxkaXYgY2xhc3M9XCJjb2wtbWQtNiBtYi0zXCI+XHJcblx0XHRcdDxsYWJlbCBmb3I9XCJmaXJzdE5hbWVcIj7QmNC80Y88L2xhYmVsPlxyXG5cdFx0XHQ8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImZvcm0tY29udHJvbFwiIHZhbHVlPVwiJHtpdGVtLm5hbWV9XCIgcmVhZG9ubHk+XHJcblx0XHQgIDwvZGl2PlxyXG5cdFx0ICA8ZGl2IGNsYXNzPVwiY29sLW1kLTYgbWItM1wiPlxyXG5cdFx0XHQ8bGFiZWwgZm9yPVwibGFzdE5hbWVcIj7QoNC+0LvRjDwvbGFiZWw+XHJcblx0XHRcdDxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgdmFsdWU9XCIke2l0ZW0ucm9sZX1cIiByZWFkb25seT5cclxuXHRcdCAgPC9kaXY+XHJcblx0XHQ8L2Rpdj5cclxuXHRcdDxkaXYgY2xhc3M9XCJtYi0zXCI+XHJcblx0XHQgIDxsYWJlbCBmb3I9XCJ1c2VybmFtZVwiPtCb0L7Qs9C40L08L2xhYmVsPlxyXG5cdFx0ICA8ZGl2IGNsYXNzPVwiaW5wdXQtZ3JvdXBcIj5cclxuXHRcdFx0PGRpdiBjbGFzcz1cImlucHV0LWdyb3VwLXByZXBlbmRcIj5cclxuXHRcdFx0ICA8c3BhbiBjbGFzcz1cImlucHV0LWdyb3VwLXRleHRcIj5APC9zcGFuPlxyXG5cdFx0XHQ8L2Rpdj5cclxuXHRcdFx0PGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiB2YWx1ZT1cIiR7aXRlbS51c2VybmFtZX1cIiByZWFkb25seT5cclxuXHRcdCAgPC9kaXY+XHJcblx0XHQ8L2Rpdj5cclxuXHRcdDxkaXYgY2xhc3M9XCJtYi0zXCI+XHJcblx0XHQgIDxsYWJlbCBmb3I9XCJlbWFpbFwiPkVtYWlsIDxzcGFuIGNsYXNzPVwidGV4dC1tdXRlZFwiPijQntC/0YbQuNC+0L3QsNC70YzQvdC+KTwvc3Bhbj48L2xhYmVsPlxyXG5cdFx0ICA8aW5wdXQgdHlwZT1cImVtYWlsXCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiB2YWx1ZT1cIiR7aXRlbS5lbWFpbH1cIiByZWFkb25seT5cclxuXHRcdDwvZGl2PlxyXG5cdFx0PGRpdiBjbGFzcz1cIm1iLTNcIj5cclxuXHRcdCAgPGxhYmVsIGZvcj1cImFkZHJlc3NcIj7QkNC00YDQtdGBPC9sYWJlbD5cclxuXHRcdCAgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiB2YWx1ZT1cIiR7aXRlbS5hZGRyZXNzLnppcGNvZGV9LCAke2l0ZW0uYWRkcmVzcy5jaXR5fSwgJHtpdGVtLmFkZHJlc3Muc3RyZWV0fVwiIHJlYWRvbmx5PlxyXG5cdFx0PC9kaXY+XHJcblx0XHQ8ZGl2IGNsYXNzPVwibWItM1wiPlxyXG5cdFx0ICA8bGFiZWwgZm9yPVwiYWRkcmVzczJcIj7QodCw0LnRgjwvbGFiZWw+XHJcblx0XHQgIDxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgdmFsdWU9XCIke2l0ZW0ud2Vic2l0ZX1cIiByZWFkb25seT5cclxuXHRcdDwvZGl2PlxyXG5cdCAgPC9mb3JtPmA7XHJcblx0fTtcclxuXHJcblxyXG5cdHNlbGVjdEFsbEl0ZW1zICgpe1xyXG5cdFx0bGV0IGNoZWNrYm94ZXMgPSB0aGlzLkRPTUVsZW1lbnRzLnVzZXJMaXN0LnF1ZXJ5U2VsZWN0b3JBbGwoXCJpbnB1dFt0eXBlPWNoZWNrYm94XVwiKTtcclxuXHRcdGNoZWNrYm94ZXMuZm9yRWFjaChpdGVtID0+IHRoaXMuRE9NRWxlbWVudHMuc2VsZWN0QWxsLmNoZWNrZWQgPyBpdGVtLmNoZWNrZWQgPSB0cnVlIDogaXRlbS5jaGVja2VkID0gZmFsc2UpO1xyXG5cdH1cclxuXHJcbiAgICBzZWxlY3RUYWJsZUxpbmUoZXZlbnQpIHtcclxuXHRcdGxldCB0YWJsZUxpbmVzID0gZXZlbnQuY3VycmVudFRhcmdldC5xdWVyeVNlbGVjdG9yQWxsKFwidHJcIik7XHJcblx0XHR0YWJsZUxpbmVzLmZvckVhY2goaXRlbT0+aXRlbS5jbGFzc0xpc3QucmVtb3ZlKFwidGFibGUtYWN0aXZlXCIpKTtcclxuXHRcdGV2ZW50LnRhcmdldC5jbG9zZXN0KFwidHJcIikuY2xhc3NMaXN0LmFkZChcInRhYmxlLWFjdGl2ZVwiKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY2xlYXJMaXN0KCl7XHJcbiAgICAgICAgdGhpcy5ET01FbGVtZW50cy51c2VyTGlzdC5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgICAgIHRoaXMuaGlkZU5leHRQYWdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlQnV0dG9uVGV4dChldmVudCl7XHJcbiAgICAgICAgZXZlbnQuY3VycmVudFRhcmdldC5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uXCIpLmlubmVySFRNTCA9IGV2ZW50LnRhcmdldC5pbm5lclRleHQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0U29ydGluZ1R5cGUoZXZlbnQpIHtcclxuICAgICAgICByZXR1cm4gZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZShcInNvcnRpbmctdHlwZVwiKTtcclxuICAgIH1cclxuXHJcblx0YmxvY2tOZXh0UGFnZSgpIHtcclxuXHRcdHRoaXMuRE9NRWxlbWVudHMubmV4dEJ0bi5jbGFzc0xpc3QuYWRkKFwiZGlzYWJsZWRcIik7XHJcbiAgICB9XHJcblxyXG4gICAgaGlkZU5leHRQYWdlKCkge1xyXG5cdFx0dGhpcy5ET01FbGVtZW50cy5uZXh0QnRuLmNsYXNzTGlzdC5hZGQoXCJoaWRlXCIpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBzaG93U3RhdHMoc3RhdHMpe1xyXG4gICAgICAgIHRoaXMuRE9NRWxlbWVudHMuc3RhdHNJbmZvLmlubmVySFRNTCA9IGDQodGC0LDRgtC40YHRgtC40LrQsCDRgdC40YHRgtC10LzRiy4g0JDQtNC80LjQvdC+0LI6ICR7c3RhdHMuYWRtaW5zfSwg0J/QvtC70YzQt9C+0LLQsNGC0LXQu9C10Lk6ICR7c3RhdHMudXNlcnN9YDtcclxuICAgIH1cclxuXHJcbiAgICBidWlsZFVzZXJzTGlzdChwYWdlLCBmaWx0ZXJTb3J0RnVuY3Rpb24pIHtcdFx0XHJcblx0XHRmaWx0ZXJTb3J0RnVuY3Rpb24gJiYgKHBhZ2UgPSBmaWx0ZXJTb3J0RnVuY3Rpb24ocGFnZSkpO1xyXG5cdFx0bGV0IHJlc3VsdCA9IHBhZ2UubWFwKGl0ZW0gPT4gdGhpcy50YWJsZVRlbXBsYXRlKGl0ZW0pKTtcclxuXHRcdHRoaXMuRE9NRWxlbWVudHMudXNlckxpc3QuaW5uZXJIVE1MICs9IHJlc3VsdC5qb2luKFwiXCIpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBzaG93U2luZ2xlVXNlcihpdGVtKSB7XHJcbiAgICAgICAgdGhpcy5ET01FbGVtZW50cy51c2Vyc0xpc3QuZm9yRWFjaChpdGVtID0+IGl0ZW0uY2xhc3NMaXN0LmFkZChcImhpZGVcIikpO1xyXG4gICAgICAgIHRoaXMuRE9NRWxlbWVudHMuc2luZ2xlVXNlci5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZVwiKTtcclxuICAgICAgICB0aGlzLkRPTUVsZW1lbnRzLnNpbmdsZVVzZXJEZXRhaWxzLmlubmVySFRNTCA9IHRoaXMuc2luZ2xlVXNlclRlbXBsYXRlKGl0ZW0pO1xyXG4gICAgfVxyXG5cclxuICAgIGhpZGVTaW5nbGVVc2VyKCkge1xyXG4gICAgICAgIHRoaXMuRE9NRWxlbWVudHMuc2luZ2xlVXNlci5jbGFzc0xpc3QuYWRkKFwiaGlkZVwiKTtcclxuICAgICAgICB0aGlzLkRPTUVsZW1lbnRzLnVzZXJzTGlzdC5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZVwiKSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbiIsImltcG9ydCB7dXBkYXRlUm91dGV9IGZyb20gJy4vcm91dGVyLmpzJ1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIHVwZGF0ZVJvdXRlKTtcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdoYXNoY2hhbmdlJywgdXBkYXRlUm91dGUpO1xuXG4iXX0=
